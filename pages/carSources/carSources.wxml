<!-- 货源列表（原车源详情） -->
<import src="../../lib/dialog/dialog.wxml"/>
<template is="dialog" data="{{ ...$wux.dialog }}"/>

<!-- 货源列表 -->
<view class="car-sources container">
	<!-- SPU 详情展示 -->
	<view class="carSources-topbar weui-media-box weui-media-box_appmsg" hover-class="weui-cell_active">
		<view class="weui-media-box__hd weui-media-box__hd_in-appmsg">
			<image class="weui-media-box__thumb" src="{{imgAliyuncsUrl}}{{carModelsInfo.lowestPriceSku.skuPic}}" />
		</view>
		<view class="weui-media-box__bd weui-media-box__bd_in-appmsg">
			<view class="weui-media-box__title">{{carModelsInfo.carModelName}}</view>
			<view class="weui-media-box__desc">指导价{{carModelsInfo.officialPriceStr}}万</view>
		</view>
	</view>

	<!-- 页面主体 -->
	<view class="carSources-body">
		<!-- 下拉框筛选 -->
		<view class="carSources-navbar">
			<view
					class="navbar cars-facade"
					bindtap="handlerAmendCarFacade"
					data-selected-filter-index="0"
			>
				<view class="navbar-text">
					{{selectedCarColorName}}
					<image
							wx:if="{{showRmendCarFacade && selectedFilterIndex === '0'}}"
							class="icon-dropdownarrow"
							src="../../images/icons/icon_dropdownarrow_up_gray.png"
					></image>
					<image
							wx:else
							class="icon-dropdownarrow"
							src="../../images/icons/icon_dropdownarrow_down_gray.png"
					></image>
				</view>
			</view>
			<view
					class="navbar cars-facade"
					bindtap="handlerAmendCarFacade"
					data-selected-filter-index="1"
			>
				<view class="navbar-text">
					{{selectedSourceRegionName}}
					<image
							wx:if="{{showRmendCarFacade && selectedFilterIndex === '1'}}"
							class="icon-dropdownarrow"
							src="../../images/icons/icon_dropdownarrow_up_gray.png"
					>
					</image>
					<image
							wx:else
							class="icon-dropdownarrow"
							src="../../images/icons/icon_dropdownarrow_down_gray.png"
					>
					</image>
				</view>
			</view>
		</view>
		<!-- 条件筛选.-->
		<view wx:if="{{showRmendCarFacade}}" class="rmendCarFacade-popup-wrap">
			<view
					class="rmendCarFacade-popup-mask showMask"
					bindtap="headlerRemoveRmendCarFacade"
			></view>
			<view class="rmendCarFacade-inner topToBottom">
				<scroll-view scroll-y style="height: 520rpx">
					<view
							class="weui-cell weui-cell_access"
							hover="true"
							hover-class="weui-cell_active"
							wx:for="{{dropDownFiltersData}}"
							wx:for-item="filterItem"
							bindtap="handlerSelectItem"
							data-filter-item="{{filterItem}}"
					>
						<view class="weui-cell__bd weui-cell_primary">
							<view>{{filterItem.name}}</view>
						</view>
						<view
								wx:if="{{(selectedFilterIndex == 0 && selectedCarColorId == filterItem.id) || (selectedFilterIndex == 1 && selectedSourceRegionId == filterItem.id)}}"
								class="weui-cell__ft">
							<image src="../../images/icons/icon_select_red.png"></image>
						</view>
					</view>
				</scroll-view>
			</view>
		</view>
		<!-- 标签选择 -->
		<view>
				<scroll-view
						scroll-x="true"
						style="height: 80rpx; width: 100%;"
						class="filter-scroll-view">
					<view
							wx:for="{{scrollFilters}}"
							wx:for-index="scrollFilterIndex"
							wx:for-item="scrollFilterItem"
							class="weui-flex scrollFilter"
					>
						<view
							wx:for="{{scrollFilterItem.items}}"
							wx:for-index="filterIndex"
							wx:for-item="filterItem"
						>
							<button
									wx:if="{{filterIndex == scrollFiltersSelectedIndexes[scrollFilterIndex]}}"
									bindtap="handlerFilterSelected"
									data-scroll-filter-index="{{scrollFilterIndex}}"
									data-scroll-filter-item="{{scrollFilterItem}}"
									data-filter-Index="{{filterIndex}}"
									data-filter-item="{{filterItem}}"
									class="filter selected weui-flex__item"
							>
								{{filterItem.name}}
							</button>
							<button wx:else
									bindtap="handlerFilterSelected"
									data-scroll-filter-index="{{scrollFilterIndex}}"
									data-scroll-filter-item="{{scrollFilterItem}}"
									data-filter-Index="{{filterIndex}}"
									data-filter-item="{{filterItem}}"
									class="filter unselected weui-flex__item"
							>
								{{filterItem.name}}
							</button>
						</view>
					</view>
				</scroll-view>
		</view>
		<!-- 货源列表 -->
		<view
				wx:if="{{carSourcesBySkuInSpuList.length > 0}}"
				class="carSources-sections"
		>
			<view
					wx:for="{{carSourcesBySkuInSpuList}}"
					wx:for-item="skuItem"
					wx:for-index="skuItemIndex"
					class="carSources-section"
			>
				<view class="carSources-section-content"
					  bindtap="handlerSelectSku"
					  data-sku-index="{{skuItemIndex}}"
					  data-sku-item="{{skuItem}}"
				>
					<!-- 库存分区列表 -->
					<view class="title">
						{{skuItem.carSku.externalColorName}}/{{skuItem.carSku.internalColorName}}
					</view>
					<view class = "carSources-section-price">
						<view
								wx:if="{{skuItem.carSourcesList[0].discount > 0}}"
								class="discount-icon"
						>
							<image src="../../images/icons/icon_price_down.png"></image>
						</view>
						<view
								wx:else
								class="discount-icon"
						>
							<image src="../../images/icons/icon_price_up.png"></image>
						</view>
						<view class="discount">{{skuItem.carSourcesList[0].discount}}万/</view>
						<view>
							<view class="price">{{skuItem.carSourcesList[0].price}}万</view>
						</view>
					</view>
					<view wx:if="{{skuItem.carSourcesList[0].logisticsFree}}">
						<view class="logisticsFree" wx:if="{{skuItem.carSourcesList[0].logisticsType === 'store'}}">包邮到门店</view>
						<view class="logisticsFree" wx:if="{{skuItem.carSourcesList[0].logisticsType === 'post'}}">包邮到驿站</view>
					</view>
					<!-- 货源右侧的展开标记 -->
					<image
							wx:if="{{skuItemIndex === selectedSectionIndex}}"
							class="icon-dropdownarrow"
							src="../../images/icons/icon_dropdownarrow_up_gray.png"
					>
					</image>
					<image
							wx:else
							class="icon-dropdownarrow"
							src="../../images/icons/icon_dropdownarrow_down_gray.png"
					>
					</image>
				</view>

				<view wx:if="{{skuItemIndex === selectedSectionIndex}}">
					<view
							wx:if="{{skuItem.carSourcesList.length > 0}}"
							class="carSources-cells"
					>
						<view
								wx:for="{{skuItem.carSourcesList}}"
								wx:for-item="carSourceItem"
								wx:for-index="carSourceItemIndex"
								class="carSources-cell"
						>
							<view class="carSources-cell-content">
								<!-- 第一部分-货源基本信息 -->
								<!-- 供应商名称 -->
								<view class="supplier-name">
									<view class="name">{{carSourceItem.supplier.name}}</view>
									<view wx:if="{{carSourceItem.supplierSelfSupport}}" class="certification">V</view>
								</view>

								<!-- 关注靠谱 -->
								<view wx:if="{{carSourceItem.supplierSelfSupport}}}" class="social"></view>
								<view wx:else class="social">
									<button
											wx:if="{{carSourceItem.supplier.hasFocused}}"
											class="none-follow"
											bindtap="handlerFollow"
											data-sku-index="{{skuItemIndex}}"
											data-sku="{{skuItem}}"
											data-car-source-index="{{carSourceItemIndex}}"
											data-car-source="{{carSourceItem}}"
											data-supplier="{{carSourceItem.supplier}}"
									>
										已关注
									</button>
									<button
											wx:else
											class="followed"
											disabled="true"
											bindtap="handlerFollow"
											data-sku-index="{{skuItemIndex}}"
											data-sku="{{skuItem}}"
											data-car-source-index="{{carSourceItemIndex}}"
											data-car-source="{{carSourceItem}}"
											data-supplier="{{carSourceItem.supplier}}"
									>
										关注
									</button>
									<button
											wx:if="{{carSourceItem.supplier.hasBeenReliable}}"
											class="reliabled"
											bindtap="handlerReliable"
											data-sku-index="{{skuItemIndex}}"
											data-sku="{{skuItem}}"
											data-car-source-index="{{carSourceItemIndex}}"
											data-car-source="{{carSourceItem}}"
											data-supplier="{{carSourceItem.supplier}}"
									>
										靠谱
									</button>
									<button
											wx:else
											class="none-reliable"
											bindtap="handlerReliable"
											data-sku-index="{{skuItemIndex}}"
											data-sku="{{skuItem}}"
											data-car-source-index="{{carSourceItemIndex}}"
											data-car-source="{{carSourceItem}}"
											data-supplier="{{carSourceItem.supplier}}"
									>
										靠谱
									</button>
								</view>

								<!-- 车源基本信息 -->
								<view class="basic-infomation">
									<view class="basic-label">{{carSourceItem.sourceRegionDesc}}</view>
									<view class="basic-label">{{carSourceItem.salableRegionsDesc}}</view>
									<view class="basic-label">{{carSourceItem.procedureTypeDesc}}</view>
								</view>

								<!-- 是否为一口价 -->
								<view wx:if="{{carSourceItem.priceFixed}}" class="pricefixed">
									<view class="label">一口价</view>
									<image><!-- 一口价图标 --></image>
								</view>

								<!-- 供货价格 -->
								<view class = "carSources-cell-price">
									<view
											wx:if="{{carSourceItem.discount > 0}}"
											class="discount-icon"
									>
										<image src="../../images/icons/icon_price_down.png"></image>
									</view>
									<view
											wx:else
											class="discount-icon"
									>
										<image src="../../images/icons/icon_price_up.png"></image>
									</view>
									<view class="discount">{{carSourceItem.discount}}万/</view>
									<view>
										<view class="price">{{carSourceItem.price}}万</view>
									</view>
								</view>

								<!-- 货源渠道信息 -->
								<view wx:if="{{!carSourceItem.supplierSelfSupport}}}" class="carSourceChannel">
									<view class="publishDate">{{carSourceItem.carSourcePublishDateDesc}}</view>
									<view class="channel">{{carSourceItem.carSourceChannel}}</view>
								</view>

								<!-- 第二部分-物流信息 -->

								<!-- 物流信息-费用和时间 -->
								<view class="logistics-fee">
									<view wx:if="{{carSourceItem.logisticsFree}}" class="logistics-free">
										<view wx:if="{{carSourceItem.logisticsType === 'store'}}">包邮到门店</view>
										<view wx:if="{{carSourceItem.logisticsType === 'post'}}">包邮到驿站</view>
									</view>
									<view wx:else class="logistics-none-free">
										<view>
											运费约: {{carSourceItem.selectedLogistics.logisticsFeeDesc}}
										</view>
									</view>
								</view>
								<view class="logistics-date">
									{{carSourceItem.selectedLogistics.expectedDeliveryDateDesc}}
								</view>
								<view class="logistics-tips">
									(物流时间仅供参考)
								</view>

								<!-- 物流信息-物流选择块 -->
								<view wx:for="{{carSourceItem.logistics}}"
									  wx:for-item="logisticsItem"
									  wx:for-index="logisticsItemIndex"
									  class="logistics-list"
								>
									<view class="logistics-block"
										  bindtap="handlerSelectLogisticsBlock"
										  data-sku-index="{{skuItemIndex}}"
										  data-sku="{{skuItem}}"
										  data-car-source-index="{{carSourceItemIndex}}"
										  data-car-source="{{carSourceItem}}"
										  data-logistics-index="{{logisticsItemIndex}}"
										  data-logistics="{{logisticsItem}}"
									>
										驿站{{logisticsItemIndex}}{{logisticsItem.destination}}
									</view>
								</view>

								<!-- 要买车平台自营的描述信息 -->
								<view wx:if="{{carSourceItem.supplierSelfSupport}}">
									<view class="label">定金拿车， 到货前0利息</view>
									<view class="tips-label">(到货后， 5天内万4， 5天外万6)</view>
								</view>

								<!-- 第三部分-底部按钮 -->
								<button class="button-normal"
										bindtap="handlerContact"
										data-car-source="{{carSourceItem}}"
								>
									联系
								</button>
								<view wx:if="{{carSourceItem.supplierSelfSupport}}">
									<button
											class="button-confirm"
											bindtap="handlerBookCar"
											data-sku="skuItem"
											data-car-source="{{carSourceItem}}"
									>
										定车
									</button>
								</view>
							</view>
						</view>
					</view>
					<view wx:else class="nodata">
						该 SKU 下供货暂无数据
					</view>
				</view>
			</view>
		</view>
		<view wx:else class="nodata">
			供货暂无数据
		</view>
	</view>
</view>

